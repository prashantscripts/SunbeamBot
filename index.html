<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice-Enabled Chatbot</title>
</head>
<body>
    <h1>Chat with SunbeamBot</h1>
    <input type="text" id="userInput" placeholder="Type a message or click Speak" />
    <button id="sendButton">Send</button>
    <button id="speakButton">Speak</button>

    <script>
        const apiUrl = "https://api-bf738831-5030-460b-9891-ac5446aae79c.sendbird.com/v3";
        const apiToken = "06ab48d570b66099a56975c0de1ad7762ea904b6";
        const userId = "sbsg";
        const accessToken = "ba8da239173d8a8375c2cb3a0ca4a477d86937c0";

        // Function to send a message to the chatbot
        async function sendMessage(message) {
            const endpoint = `${apiUrl}/users/${userId}/messages`;
            try {
                const response = await fetch(endpoint, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Api-Token": apiToken,
                    },
                    body: JSON.stringify({
                        message_type: "MESG",
                        user_id: userId,
                        message: message,
                    }),
                });
                const data = await response.json();
                if (data.message) {
                    speak(data.message); // Speak the response
                } else {
                    console.error("Error: ", data);
                }
            } catch (error) {
                console.error("Message sending failed: ", error);
            }
        }

        // Function to use Speech Synthesis for output
        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            window.speechSynthesis.speak(utterance);
        }

        // Button click to send text input message
        document.getElementById("sendButton").addEventListener("click", () => {
            const input = document.getElementById("userInput").value;
            if (input) {
                sendMessage(input);
            }
        });

        // Button click to activate voice input
        document.getElementById("speakButton").addEventListener("click", () => {
            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = "en-US";
            recognition.onresult = (event) => {
                const spokenText = event.results[0][0].transcript;
                document.getElementById("userInput").value = spokenText;
                sendMessage(spokenText); // Send the spoken message
            };
            recognition.start();
        });
    </script>
</body>
</html>