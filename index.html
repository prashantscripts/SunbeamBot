<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Voice Chatbot</title>
</head>
<body>
  <div>
    <h1>Voice-Enabled Chatbot</h1>
    <textarea id="chatBox" rows="10" cols="50" readonly></textarea>
    <br />
    <button id="speakBtn">Speak</button>
  </div>

  <script>
    // Speech Recognition for voice input
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    const chatBox = document.getElementById('chatBox');
    const speakBtn = document.getElementById('speakBtn');

    // Sendbird Config
    const API_URL = 'https://api-bf738831-5030-460b-9891-ac5446aae79c.sendbird.com/v3';
    const API_TOKEN = '06ab48d570b66099a56975c0de1ad7762ea904b6';
    const USER_ID = 'sbsg'; // Your chatbot user ID

    // Text-to-Speech (eSpeak NG or Web Speech API)
    const speakText = (text) => {
      const msg = new SpeechSynthesisUtterance(text); // Use Web Speech API for simplicity
      msg.lang = 'en-US';
      window.speechSynthesis.speak(msg);
    };

    // Handle voice input
    speakBtn.addEventListener('click', () => {
      recognition.start();
    });

    recognition.onresult = async (event) => {
      const userInput = event.results[0][0].transcript;
      chatBox.value += `You: ${userInput}\n`;

      // Send user input to Sendbird
      const response = await fetch(`${API_URL}/users/${USER_ID}/messages`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Api-Token': API_TOKEN
        },
        body: JSON.stringify({
          message_type: 'MESG',
          user_id: USER_ID,
          message: userInput
        })
      });

      const data = await response.json();
      if (data.error) {
        chatBox.value += `Error: ${data.message}\n`;
      } else {
        const botResponse = data.message;
        chatBox.value += `Bot: ${botResponse}\n`;

        // Speak the response
        speakText(botResponse);
      }
    };

    recognition.onerror = (error) => {
      console.error('Speech recognition error:', error);
    };
  </script>
</body>
</html>